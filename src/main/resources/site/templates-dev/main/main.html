{% extends "../index.peb" %}

{% block content %}
<style>
    .background {
        background: rgb(15, 15, 15);
        background: linear-gradient(0deg, rgba(15, 15, 15, 1) 0%, rgba(13, 13, 13, 0.8001401244091386) 100%);
        /* background-image: linear-gradient(to bottom, #434343 0%, black 100%); */
        /* background-image: linear-gradient(60deg, #29323c 0%, #485563 100%); */
        height: 100vh;
        overflow-y: scroll;
        overflow-x: hidden;
        position: relative;
    }

    .background-image {
        width: 100%;
        height: 100%;
        object-fit: cover;
        filter: grayscale(100%);
        position: relative;
        clip-path: circle(40% at 100% 0);
        z-index: 2;
        transition: .5s ease-in;
    }

    /* .background-image:hover {
        clip-path: circle(42% at 100% 0);
    } */

    .mask {
        position: absolute;
        top: 0;
        right: 0;
        width: 100px;
        height: 100px;
        -webkit-mask-image: url("data:image/svg+xml,<svg width='100' height='100'><circle cx='50' cy='50' r='50' fill='white'/></svg>");
        mask-image: url("data:image/svg+xml,<svg width='100' height='100'><circle cx='50' cy='50' r='50' fill='white'/></svg>");
    }

    #title {
        position: absolute;
        top: 25%;
        right: 10%;
        display: flex;
        align-items: flex-start;
        color: white;
        flex-direction: column;
        z-index: 2;
        pointer-events: none;
    }

    #title:hover .background-image {
        transform: scale(1.1);
    }
</style>

<div class="background">
    <img class="background-image" src="/images/abstract.jpg"></img>
    <div id="title"
        style="position: absolute; top: 20%; right: 8%; display: flex; align-items: flex-start; color: white; flex-direction: column; z-index: 2;">
        <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="currentColor" class="bi bi-pc-display"
            viewBox="0 0 16 16">
            <path
                d="M8 1a1 1 0 0 1 1-1h6a1 1 0 0 1 1 1v14a1 1 0 0 1-1 1H9a1 1 0 0 1-1-1zm1 13.5a.5.5 0 1 0 1 0 .5.5 0 0 0-1 0m2 0a.5.5 0 1 0 1 0 .5.5 0 0 0-1 0M9.5 1a.5.5 0 0 0 0 1h5a.5.5 0 0 0 0-1zM9 3.5a.5.5 0 0 0 .5.5h5a.5.5 0 0 0 0-1h-5a.5.5 0 0 0-.5.5M1.5 2A1.5 1.5 0 0 0 0 3.5v7A1.5 1.5 0 0 0 1.5 12H6v2h-.5a.5.5 0 0 0 0 1H7v-4H1.5a.5.5 0 0 1-.5-.5v-7a.5.5 0 0 1 .5-.5H7V2z" />
        </svg>
        <p style="font-size: 24px; letter-spacing: 5px;" class="title-content">BITSYMPHONY</p>
    </div>
    <div class="line-group">
        <div class="line"></div>
        <div class="line"></div>
        <div class="line"></div>
    </div>
    {% if configs.initial_run == "true" %}
    <div x-data="
        {
            step: 1,
            formData: {
                username: '',
                defaultDirectory: '{{ configs.default_directory }}',
                fileChunkSize: '{{ configs.chunk_size }}',
                testIntervalTime: '{{ configs.test_interval }}',
            },
            isLastStep: false,

            nextStep() {
                if (this.step === 1 && !this.formData.username) {
                    return;
                }

                this.step++;
                this.isLastStep = (this.step === 4);
            },

            prevStep() {
                this.step--;
                this.isLastStep = false;
            },

            async submitConfig() {
                try {
                    const response = await fetch('/api/config/save', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(this.formData)
                    });

                    if (response.ok) {
                        console.log('Configuration saved successfully');
                        Alpine.store('animeTransition').animateConfigCompletion(this.formData);
                    }
                } catch (error) {
                    console.error('Error saving configs:', error);
                }
            }
        }
    ">
        <div class="form-area">
            <div x-show="step === 1" style="text-align: center;">
                <h1 style="font-weight: bold; text-align: left;">Welcome</h1>
                <p>Username</p>
                <input x-model="formData.username" placeholder="Please Enter Your Username" type="text"
                    tabindex="1"></input>
            </div>
            <div x-show="step >= 2" style="text-align: center;">
                <h1 style="font-weight: bold; text-align: left;">Configuration</h1>
                <p>Default Directory</p>
                <input x-show="step > 1" x-model="formData.defaultDirectory" placeholder="Default Directory" type="text"
                    tabindex="1"></input>
                <input x-show="step > 2" x-model="formData.fileChunkSize" placeholder="File Chunk Size" type="number"
                    default="{{ configs.chunk_size }}" class="additional-inputs" tabindex="1"></input>
                <input x-show="step > 3" x-model="formData.testIntervalTime" placeholder="Test Interval Time"
                    class="additional-inputs" type="number" tabindex="1"></input>
            </div>
            <button x-show="step < 4" @click="nextStep" type="button" class="draw-border">Continue</button>
            <button x-show="isLastStep" @click="submitConfig" type="button" class="draw-border">Finish</button>
            <button x-show="step > 1" @click="prevStep" type="button" class="draw-border draw-border-back">Back</button>
        </div>
        <div class="helper-text">
            <p x-show="step === 1">Enter your username so we&apos;ll know what to call you</p>
            <p x-show="step === 2">The default directory is where system generated files with test data will exist.
                <br /> All content can be managed from the app.
            </p>
            <p x-show="step === 3">This value dictates the number of bytes used to read the file at the fixed number of
                bytes in memory. </p>
            <p x-show="step === 4">The time taken between tests to observe changes in system performance. <br />
                The value can be changed later in system settings. </p>
        </div>
    </div>
    {% else %}
    <div class="text-area">Welcome Back Cyrus</div>
    {% endif %}
</div>

<script>
    document.addEventListener('alpine:init', () => {
        Alpine.store('animeTransition', {
            animateConfigCompletion(formData) {
                const formArea = document.querySelector(".form-area");
                const title = document.querySelector("#title");
                const lineGroup = document.querySelector('.line-group');
                const helperText = document.querySelector(".helper-text");

                anime.timeline({
                    easing: 'easeInOutQuad'
                })
                .add({
                    targets: formArea,
                    duration: 1000,
                    translateX: ['0%', '-100%'],
                    opacity: [1, 0],
                    complete: () => {
                        formArea.style.display = 'none';
                    }
                })
                .add({
                    targets: [title, helperText],
                    duration: 1000,
                    translateX: ['0%', '100%'],
                    opacity: [1, 0],
                    complete: () => {
                        title.style.display = 'none';
                        helperText.style.display = 'none';
                    }
                })
                .add({
                    targets: lineGroup.querySelectorAll('.line'),
                    top: '-100%',
                    // translateX: ['0%', '100%'],
                    opacity: [1, 0],
                    duration: 1000,
                    delay: anime.stagger(200)
                })
            }
        });
    });
</script>
{% endblock %}